<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathGPT - 你的个人AI数学解答助手</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R39JXDD9ES"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        gtag('config', 'G-R39JXDD9ES');
    </script>
    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
</head>
<body>
    <!-- 图片模态框 -->
    <div id="imageModal" class="modal">
        <span class="modal-close">&times;</span>
        <img class="modal-content" id="modalImage">
    </div>

    <header>
        <nav class="navbar">
            <div class="nav-left">
                <button class="menu-btn">☰</button>
                <img src="./images/logo.png" alt="MathGPT AI" class="logo" id="navLogo">
            </div>
        </nav>
    </header>

    <!-- 侧边栏对话历史 -->
    <div class="chat-sidebar">
        <div class="sidebar-header">
            <h3>Chat History</h3>
            <button class="new-chat-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
                New Chat
            </button>
        </div>
        <div class="chat-history">
            <!-- 对话历史列表会动态添加到这里 -->
        </div>
    </div>

    <main>
        <div class="hero-section">
            <img src="./images/logo.png" alt="MathGPT AI" class="hero-logo">
            <h1><span class="highlight">MathGPT</span> your best learning assistant</h1>
            <p>Get instant homework help from your personal AI math solver</p>
            
            <div class="tabs">
                <button class="tab active">MathGPT</button>
                <button class="tab">PhysicsGPT</button>
                <button class="tab">AccountingGPT</button>
                <button class="tab">ChemGPT</button>
            </div>

            <div class="upload-box">
                <div class="chat-container">
                    <!-- 对话内容会动态添加到这里 -->
                </div>
                <div class="input-container">
                    <div class="preview-area" style="display: none;">
                        <div class="preview-container">
                            <img id="preview-image" src="" alt="Preview">
                            <button class="remove-file-btn">×</button>
                        </div>
                    </div>
                    <div class="upload-area">
                        <img src="./images/upload-icon.svg" alt="Upload" class="upload-icon">
                        <p>Drop your files here or <a href="#" class="upload-link">click</a> to upload</p>
                        <input type="file" id="fileInput" accept=".pdf,image/*" style="display: none;">
                    </div>
                    <div class="question-wrapper">
                        <input type="text" placeholder="Type your question here..." class="question-input">
                        <button class="send-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <section class="blog-section">
        <div class="container">
            <div class="blog-list">
                <article class="blog-article">
                    <h2 class="article-title">How to Use MathGPT Effectively</h2>
                    
                    <div class="article-content">
                        <p class="article-intro">
                            To make the most of MathGPT, here are some tips and strategies for using this smart math assistant efficiently:
                        </p>
                        
                        <div class="guide-section">
                            <h3 class="article-subtitle">1. Provide Clear and Precise Input</h3>
                            <p>When using MathGPT, ensure your questions are well-structured:</p>
                            <ul>
                                <li>Be Specific: Use concise language, e.g., "Find the roots of x^2 + 2x - 8 = 0."</li>
                                <li>Break Down Complex Problems: If the problem is complex, split it into smaller parts for better understanding.</li>
                                <li>Use Standard Math Symbols: Input equations and expressions in their standard format for accurate results.</li>
                            </ul>
                        </div>
                        
                        <div class="guide-section">
                            <h3 class="article-subtitle">2. Leverage the Step-by-Step Solution Feature</h3>
                            <p>The step-by-step solution feature is invaluable for learning and problem-solving:</p>
                            <ul>
                                <li>Understand the reasoning behind each step instead of just getting the final answer.</li>
                                <li>Ask follow-up questions if a step is unclear, e.g., "Why was the chain rule applied here?"</li>
                            </ul>
                        </div>
                        
                        <div class="guide-section">
                            <h3 class="article-subtitle">3. Utilize Visualization Tools</h3>
                            <p>MathGPT's visualization tools make abstract concepts easier to grasp:</p>
                            <ul>
                                <li>Function Graphs: Input commands like "Plot y = sin(x)" to visualize function behavior.</li>
                                <li>Geometric Shapes: Generate shapes (e.g., triangles, circles) to better understand geometry.</li>
                                <li>Statistical Charts: Create histograms, scatter plots, or bar charts for statistical analysis.</li>
                            </ul>
                        </div>
                        
                        <div class="guide-section">
                            <h3 class="article-subtitle">4. Apply to Real-World Scenarios</h3>
                            <p>MathGPT isn't just for academic purposes; it's also useful for solving real-world problems:</p>
                            <ul>
                                <li>Financial Calculations: Calculate loan interest, investment returns, and more.</li>
                                <li>Engineering Applications: Solve complex equations or perform modeling tasks.</li>
                                <li>Data Analysis: Fit data to models or perform regression analysis efficiently.</li>
                            </ul>
                        </div>
                        
                        <div class="guide-section">
                            <h3 class="article-subtitle">5. Use It as a Learning Resource</h3>
                            <p>MathGPT doubles as an educational tool:</p>
                            <ul>
                                <li>Ask for definitions and applications of mathematical concepts, e.g., "What is a Taylor series?"</li>
                                <li>Practice with example problems and receive instant feedback.</li>
                                <li>Use MathGPT as a personal tutor to guide your study sessions.</li>
                            </ul>
                        </div>
                        
                        <div class="guide-section">
                            <h3 class="article-subtitle">6. Multilingual Support for Global Collaboration</h3>
                            <p>If learning math terms in another language or working with international teams, MathGPT's multilingual support can help:</p>
                            <ul>
                                <li>Input questions in different languages to explore comparative solutions.</li>
                                <li>Learn mathematical standards and expressions used globally.</li>
                            </ul>
                        </div>
                        
                        <div class="guide-section">
                            <h3 class="article-subtitle">7. Combine with Other Tools</h3>
                            <ul>
                                <li>Integrate MathGPT with online learning platforms for classroom presentations or quizzes.</li>
                                <li>Pair it with programming tools to handle complex computations and incorporate results into projects.</li>
                            </ul>
                        </div>
                        
                        <div class="guide-section">
                            <h3 class="article-subtitle">8. Explore Advanced Features</h3>
                            <p>Once familiar, try MathGPT's advanced capabilities:</p>
                            <ul>
                                <li>Solving Systems of Equations: Input multivariable equations to find quick solutions.</li>
                                <li>Optimization Problems: Solve for maximum or minimum values, useful in economics and engineering.</li>
                                <li>Complex Modeling: Validate hypotheses or run simulation calculations for research projects.</li>
                            </ul>
                        </div>
                        
                        <div class="article-conclusion">
                            <p>By applying these strategies, you can unlock the full potential of MathGPT, making math problem-solving faster, more accurate, and more insightful. If you have any questions or specific needs, feel free to ask—MathGPT is here to assist you anytime!</p>
                        </div>
                    </div>
                </article>

                <article class="blog-article">
                    <h2 class="article-title">MathGPT: Your smart math assistant</h2>
                    
                    <div class="article-content">
                        <p class="article-intro">
                            MathGPT is an intelligent mathematics assistant developed based on artificial intelligence technology, designed to help students, educators, researchers and all kinds of people interested in mathematics solve mathematics-related problems efficiently.
                        </p>
                        
                        <p class="article-description">
                            Whether it's basic arithmetic operations, complex algebraic equations, or advanced calculus and linear algebra problems, MathGPT can provide you with accurate and fast answers while also having rich teaching features.
                        </p>
                    </div>
                </article>

                <article class="blog-article">
                    <h2 class="article-title">MathGPT core functionality: Intelligent computing</h2>
                    
                    <div class="article-content">
                        <p class="article-intro">
                            MathGPT can handle problems ranging from simple four arithmetic operations to complex advanced mathematics, including:
                        </p>
                        
                        <div class="feature-list">
                            <ul>
                                <li>Solving algebraic equations</li>
                                <li>Geometry problem analysis</li>
                                <li>Calculus operations</li>
                                <li>Statistics and Probability Analysis</li>
                                <li>Matrix operations and linear algebra</li>
                            </ul>
                        </div>
                    </div>
                </article>

                <article class="blog-article">
                    <h2 class="article-title">How to study mathematics tutorials efficiently?</h2>
                    
                    <div class="article-content">
                        <h3 class="article-subtitle">Step-by-step problem-solving guide</h3>
                        <p class="article-description">
                            MathGPT not only gives answers, but also demonstrates the problem-solving process step by step to help users understand the principles of each operation. For students, this functionality serves as a powerful tool for self-study.
                        </p>
                        
                        <h3 class="article-subtitle">Provide visual display</h3>
                        <p class="article-description">
                            MathGPT provides graphical functions that can draw function images, statistical charts, and geometric figures to help users understand mathematical concepts more intuitively.
                        </p>
                        
                        <h3 class="article-subtitle">Multi-language support</h3>
                        <p class="article-description">
                            Supports mathematical terminology parsing and answering functions in multiple languages ​​to meet the needs of global users.
                        </p>
                    </div>
                </article>
            </div>
        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const API_URL = 'https://api.chatanywhere.tech/v1/chat/completions';
            const API_KEY = 'sk-mfeFE41QyBhcRHOpQF6YY5cdu1nacylyXh7lIRYP9jTXWTLP';
            const tabs = document.querySelectorAll('.tab');
            const questionInput = document.querySelector('.question-input');
            const sendButton = document.querySelector('.send-btn');
            const chatContainer = document.querySelector('.chat-container');
            const fileInput = document.getElementById('fileInput');
            const uploadLink = document.querySelector('.upload-link');
            const previewArea = document.querySelector('.input-container .preview-area');
            const previewImage = document.getElementById('preview-image');
            const removeFileBtn = document.querySelector('.remove-file-btn');
            
            // 处理上传链接点击
            uploadLink.addEventListener('click', function(e) {
                e.preventDefault();
                fileInput.click();
            });
            
            // 处理上传区域点击
            const uploadArea = document.querySelector('.upload-area');
            uploadArea.addEventListener('click', function(e) {
                // 如果点击的不是链接和移除按钮
                if (!e.target.classList.contains('upload-link') && 
                    !e.target.classList.contains('remove-file-btn')) {
                    fileInput.click();
                }
            });
            
            let selectedFile = null;  // 存储选中的文件
            
            // 处理文件选择
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (file.type.startsWith('image/') || file.type === 'application/pdf') {
                        selectedFile = file;
                        if (file.type.startsWith('image/')) {
                            previewImage.src = URL.createObjectURL(file);
                            document.querySelector('.input-container .preview-area').style.display = 'block';
                            if (document.body.classList.contains('focus-mode')) {
                                document.querySelector('.input-container .preview-area').style.opacity = '1';
                                document.querySelector('.input-container .preview-area').style.visibility = 'visible';
                            }
                        }
                    } else {
                        addMessage('Please select an image or PDF file.', false);
                        selectedFile = null;
                        document.querySelector('.input-container .preview-area').style.display = 'none';
                    }
                }
            });
            
            // 处理移除文件
            removeFileBtn.addEventListener('click', function() {
                selectedFile = null;
                document.querySelector('.input-container .preview-area').style.display = 'none';
                previewImage.src = '';
                fileInput.value = '';
            });
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            function addMessage(content, isUser = false, isLoading = false) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'} ${isLoading ? 'loading' : ''}`;
                
                if (isUser) {
                    messageDiv.textContent = content;
                } else {
                    try {
                        const rendered = marked.parse(content);
                        
                        // 直接渲染所有 LaTeX 表达式
                        const processedContent = rendered.replace(/\\[a-zA-Z]+{[^}]+}|\\[a-zA-Z]+/g, (match) => {
                            try {
                                return katex.renderToString(match, {
                                    displayMode: true,
                                    throwOnError: false
                                });
                            } catch (err) {
                                console.error('KaTeX error:', err);
                                return match;
                            }
                        });
                        
                        messageDiv.innerHTML = processedContent;
                    } catch (error) {
                        console.error('Rendering error:', error);
                        messageDiv.textContent = content;
                    }
                }
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                return messageDiv;
            }

            async function sendToGPT(question, imageUrl = null) {
                const maxRetries = 3;
                let retryCount = 0;
                
                while (retryCount < maxRetries) {
                    try {
                        console.log('Sending request to GPT...', { question, imageUrl });
                        const response = await fetch(API_URL, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${API_KEY}`
                            },
                            body: JSON.stringify({
                                model: "gpt-3.5-turbo",
                                messages: [
                                    {
                                        role: "system",
                                        content: `You are MathGPT, an AI math expert. Follow these formatting rules:
                                                1. Start with "To solve this problem, we will follow the steps outlined:"
                                                2. Number each step clearly
                                                3. Write mathematical expressions directly in LaTeX format without $ symbols
                                                4. Show all calculations step by step
                                                5. Explain each step clearly
                                                6. End with a clear conclusion
                                                7. Example format:
                                                   The function f(x) = x^2 + 2x + 1
                                                   To solve, we use the quadratic formula:
                                                   x = \\frac{-b \\pm \\sqrt{b^2-4ac}}{2a}`
                                    },
                                    {
                                        role: "user",
                                        content: question
                                    }
                                ],
                                temperature: 0.7,
                                max_tokens: 2000
                            })
                        });
                        
                        console.log('Response status:', response.status);
                        if (!response.ok) {
                            const errorData = await response.text();
                            console.error('API Error:', errorData);
                            retryCount++;
                            if (retryCount < maxRetries) {
                                await new Promise(resolve => setTimeout(resolve, 1000 * retryCount));
                                continue;
                            }
                            throw new Error('API request failed');
                        }
                        
                        const data = await response.json();
                        console.log('API Response:', data);
                        return data.choices[0].message.content;
                    } catch (error) {
                        console.error('Error details:', {
                            message: error.message,
                            stack: error.stack,
                            retryCount
                        });
                        if (retryCount >= maxRetries - 1) {
                            return 'Sorry, I encountered an error processing your request.';
                        }
                        retryCount++;
                        await new Promise(resolve => setTimeout(resolve, 1000 * retryCount));
                    }
                }
            }

            async function handleSend() {
                const question = questionInput.value.trim();
                if (question || selectedFile) {
                    // 立即隐藏预览区域和清除预览图片
                    const previewArea = document.querySelector('.input-container .preview-area');
                    if (previewArea) {
                        previewArea.style.display = 'none';
                        previewImage.src = '';
                    }
                    
                    // 进入专注模式
                    document.body.classList.add('focus-mode');
                    
                    if (selectedFile) {
                        if (selectedFile.type.startsWith('image/')) {
                            // 创建图片消息
                            const messageDiv = document.createElement('div');
                            messageDiv.className = 'message user-message';
                            
                            // 添加图片
                            const img = document.createElement('img');
                            img.src = URL.createObjectURL(selectedFile);
                            img.className = 'uploaded-image';
                            messageDiv.appendChild(img);
                            
                            // 如果有问题文本，添加到图片下方
                            if (question) {
                                const textDiv = document.createElement('div');
                                textDiv.textContent = question;
                                textDiv.className = 'message-text';
                                messageDiv.appendChild(textDiv);
                            }
                            
                            // 添加消息到聊天容器
                            chatContainer.appendChild(messageDiv);
                        }
                    } else if (question) {
                        addMessage(question, true);
                    }
                    
                    const loadingMessage = addMessage('Thinking...', false, true);
                    
                    // 清除选中的文件
                    selectedFile = null;
                    
                    // 发送到 GPT 并获取响应
                    const response = await sendToGPT(question, selectedFile ? URL.createObjectURL(selectedFile) : null);
                    console.log('Got response:', response);
                    loadingMessage.remove();
                    addMessage(response);
                    
                    // 更新当前对话的标题
                    const currentChat = document.querySelector('.chat-item.active');
                    if (currentChat) {
                        const title = extractChatTitle(question);
                        const titleElement = currentChat.querySelector('svg').nextSibling;
                        if (titleElement) {
                            titleElement.textContent = ' ' + title;
                        }
                    }
                }
                
                questionInput.value = '';
            }

            sendButton.addEventListener('click', handleSend);

            questionInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleSend();
                }
            });

            // 图片加载错误处理
            document.querySelectorAll('img').forEach(img => {
                img.onerror = function() {
                    console.error('Image failed to load:', this.src);
                    // 可以设置一个默认图片
                    // this.src = '/MathGPT/images/default.png';
                };
            });

            // 初始化模态框功能
            function initializeModal() {
                const modal = document.getElementById('imageModal');
                const modalImg = document.getElementById('modalImage');
                const closeBtn = document.querySelector('.modal-close');
                
                if (modal && modalImg && closeBtn) {
                    // 关闭模态框
                    function closeModal() {
                        modal.style.display = "none";
                    }
                    
                    // 点击关闭按钮关闭模态框
                    closeBtn.onclick = closeModal;
                    
                    // 点击模态框背景关闭
                    modal.onclick = function(e) {
                        if (e.target === modal) {
                            closeModal();
                        }
                    };
                    
                    // ESC键关闭模态框
                    document.addEventListener('keydown', function(e) {
                        if (e.key === 'Escape') {
                            closeModal();
                        }
                    });
                }
            }
            
            // 在页面加载完成后初始化模态框
            document.addEventListener('DOMContentLoaded', initializeModal);

            // 添加退出专注模式的按钮
            const exitFocusBtn = document.createElement('button');
            exitFocusBtn.className = 'exit-focus-btn';
            exitFocusBtn.innerHTML = 'Exit Focus Mode';
            exitFocusBtn.style.display = 'none';
            document.querySelector('.upload-box').appendChild(exitFocusBtn);
            
            exitFocusBtn.addEventListener('click', () => {
                document.body.classList.remove('focus-mode');
                exitFocusBtn.style.display = 'none';
            });
            
            // 当进入专注模式时显示退出按钮
            document.body.addEventListener('classChange', () => {
                if (document.body.classList.contains('focus-mode')) {
                    exitFocusBtn.style.display = 'block';
                }
            });

            // 添加新对话按钮处理
            const newChatBtn = document.querySelector('.new-chat-btn');
            const chatHistory = document.querySelector('.chat-history');
            
            // 页面加载时创建第一个对话
            function createInitialChat() {
                const firstChat = document.createElement('div');
                firstChat.className = 'chat-item active';
                firstChat.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                        <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                    </svg>
                    New Conversation
                `;
                firstChat.dataset.content = '';
                
                firstChat.addEventListener('click', () => {
                    const currentChat = document.querySelector('.chat-item.active');
                    if (currentChat) {
                        currentChat.dataset.content = chatContainer.innerHTML;
                    }
                    
                    chatContainer.innerHTML = firstChat.dataset.content;
                    document.querySelectorAll('.chat-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    firstChat.classList.add('active');
                });
                
                chatHistory.appendChild(firstChat);
            }
            
            // 初始化第一个对话
            createInitialChat();

            // 从对话内容中提取主题
            function extractChatTitle(content) {
                if (!content) return 'New Conversation';
                
                // 清理内容中的HTML标签
                const cleanContent = content.replace(/<[^>]*>/g, '').trim();
                
                // 提取前20个字符作为标题
                const title = cleanContent.length > 17 ? cleanContent.slice(0, 17) + '...' : cleanContent;
                return title || 'New Conversation';
            }

            // 新对话按钮处理
            newChatBtn.addEventListener('click', () => {
                // 保存当前对话内容并更新标题
                const currentChat = document.querySelector('.chat-item.active');
                if (currentChat) {
                    currentChat.dataset.content = chatContainer.innerHTML;
                    // 更新当前对话的标题
                    const title = extractChatTitle(chatContainer.innerHTML);
                    const titleElement = currentChat.querySelector('svg').nextSibling;
                    titleElement.textContent = title;
                }
                
                // 创建新的对话
                const newChat = document.createElement('div');
                newChat.className = 'chat-item';
                newChat.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                        <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                    </svg>
                    New Conversation
                `;
                newChat.dataset.content = '';
                
                newChat.addEventListener('click', () => {
                    const currentChat = document.querySelector('.chat-item.active');
                    if (currentChat) {
                        currentChat.dataset.content = chatContainer.innerHTML;
                    }
                    
                    chatContainer.innerHTML = newChat.dataset.content;
                    document.querySelectorAll('.chat-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    newChat.classList.add('active');
                });
                
                chatHistory.appendChild(newChat);
                
                // 清空当前对话并激活新对话
                chatContainer.innerHTML = '';
                questionInput.value = '';
                document.querySelectorAll('.chat-item').forEach(item => {
                    item.classList.remove('active');
                });
                newChat.classList.add('active');
                
                // 进入专注模式
                document.body.classList.add('focus-mode');
            });

            // 处理导航栏 LOGO 点击
            const navLogo = document.getElementById('navLogo');
            navLogo.addEventListener('click', function() {
                // 如果在专注模式，退出专注模式
                if (document.body.classList.contains('focus-mode')) {
                    document.body.classList.remove('focus-mode');
                    // 清空聊天容器
                    chatContainer.innerHTML = '';
                    // 清空输入框
                    questionInput.value = '';
                    // 隐藏预览区域
                    document.querySelector('.input-container .preview-area').style.display = 'none';
                }
                // 滚动到页面顶部
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
    </script>
    <div style="display:none">
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-R39JXDD9ES"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            
            gtag('config', 'G-R39JXDD9ES');
        </script>
    </div>
</body>
</html> 